<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦¬å¹´å¥”é¨°ï¼šæ‰‹ç¹ªç‰ˆ</title>
    <style>
        body { text-align: center; background: #fdf5e6; margin: 0; font-family: sans-serif; overflow: hidden; }
        canvas { background: white; border-bottom: 5px solid #d32f2f; margin-top: 20px; touch-action: none; max-width: 100%; }
        #score { font-size: 30px; color: #d32f2f; margin: 10px; font-weight: bold; }
    </style>
</head>
<body onclick="handleClick()" onkeydown="handleKey(event)">

    <h1>ğŸ 2026 é¦¬å¹´å¥”é¨°</h1>
    <div id="score">åˆ†æ•¸: 0</div>
    <canvas id="gameCanvas" width="600" height="200"></canvas>
    <p>é»æ“Šç•«é¢è·³èºï¼Œè¶Šè·‘æœƒè¶Šå¿«å–”ï¼</p>
<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");

    // --- 1. è¼‰å…¥åœ–ç‰‡ä¸¦è¿½è¹¤é€²åº¦ ---
    let imagesLoaded = 0;
    const totalImages = 2; // é¦¬ + ç´…åŒ…
    let isLooping = false; // ã€æ–°å¢ã€‘ä¿éšªé–ï¼Œé˜²æ­¢é‡è¤‡å•Ÿå‹•
    
    const horseImg = new Image();
    horseImg.src = 'è¢å¹•æ“·å–ç•«é¢ 2026-02-17 032626';
    horseImg.onload = () => { imagesLoaded++; checkAllLoaded(); };

    const giftImg = new Image();
    giftImg.src = 'redpacket.png';
    giftImg.onload = () => { imagesLoaded++; checkAllLoaded(); };

    // å¦‚æœåœ–ç‰‡è·¯å¾‘éŒ¯äº†ï¼Œä¹Ÿè¦èƒ½åŸ·è¡Œ
    horseImg.onerror = () => { console.log("é¦¬åœ–ç‰‡è®€å–å¤±æ•—"); imagesLoaded++; checkAllLoaded(); };
    giftImg.onerror = () => { console.log("ç´…åŒ…åœ–ç‰‡è®€å–å¤±æ•—"); imagesLoaded++; checkAllLoaded(); };

    function checkAllLoaded() {
        if (imagesLoaded >= totalImages) {
            // åœ–ç‰‡éƒ½æº–å‚™å¥½äº†ï¼Œæ‰é–‹å§‹è·‘ loop
            if (!isGameOver) requestAnimationFrame(loop);
        }
    }

    // --- 2. éŠæˆ²è¨­å®š ---
    let score = 0;
    let isGameOver = false;
    let horseY = 140;
    let horseDy = 0;
    let gravity = 0.6;
    let grounded = true;
    let obstacles = [];
    let timer = 0;
    let startSpeed = 3; 
    let speed = startSpeed;

    function doJump() {
        if (grounded) {
            horseDy = -13;
            grounded = false;
        }
    }

    function handleClick() {
        if (isGameOver) reset();
        else doJump();
    }

    function handleKey(e) {
        if (e.code === "Space") {
            e.preventDefault();
            handleClick();
        }
    }

    function reset() {
        score = 0;
        isGameOver = false;
        horseY = 140;
        horseDy = 0;
        obstacles = [];
        speed = startSpeed;
        scoreEl.innerText = "åˆ†æ•¸: 0";
        loop();
    }

    function loop() {
        if (isGameOver) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        horseDy += gravity;
        horseY += horseDy;

        if (horseY > 140) {
            horseY = 140;
            horseDy = 0;
            grounded = true;
        }

        // --- ç•«é¦¬ï¼šå„ªå…ˆç•«åœ–ç‰‡ï¼ŒçœŸçš„æ²’æœ‰æ‰ç•« Emoji ---
        if (horseImg.complete && horseImg.naturalWidth !== 0) {
            ctx.drawImage(horseImg, 50, horseY, 60, 60);
        } else {
            ctx.font = "50px Arial";
            ctx.fillText("ğŸ", 50, horseY + 45);
        }

        timer++;
        if (timer > (1000 / speed)) { 
            obstacles.push({ x: 600, w: 40, h: 40 });
            timer = 0;
        }

        for (let i = obstacles.length - 1; i >= 0; i--) {
            obstacles[i].x -= speed;
            
            if (giftImg.complete && giftImg.naturalWidth !== 0) {
                ctx.drawImage(giftImg, obstacles[i].x, 155, 40, 40);
            } else {
                ctx.font = "40px Arial";
                ctx.fillText("ğŸ§§", obstacles[i].x, 185);
            }

            if (obstacles[i].x < 90 && obstacles[i].x > 30 && horseY > 100) {
                isGameOver = true;
                ctx.fillStyle = "rgba(0,0,0,0.5)";
                ctx.fillRect(0,0,600,200);
                ctx.fillStyle = "white";
                ctx.font = "24px Microsoft JhengHei";
                ctx.textAlign = "center";
                ctx.fillText("é¦¬å¤±å‰è¹„ï¼é»æ“Šé‡æ–°é–‹å§‹", 300, 100);
            }

            if (obstacles[i].x < -40) {
                obstacles.splice(i, 1);
                score++;
                scoreEl.innerText = "åˆ†æ•¸: " + score;
                speed += 0.15; 
            }
        }

        requestAnimationFrame(loop);
    }

    // ç§»é™¤æœ€åº•éƒ¨çš„ loop()ï¼Œæ”¹ç”± checkAllLoaded æ§åˆ¶å•Ÿå‹•

            loop();
    </script>
</body>

</html>

